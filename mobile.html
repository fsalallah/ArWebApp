<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Honor AR Debugger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    <div id="overlay" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-6 text-center">
        <h1 class="text-2xl font-bold mb-2">Honor AR Tester</h1>
        <p id="status-text" class="mb-6 text-sm text-gray-400">Ready to start...</p>
        
        <button id="ar-button" class="bg-blue-600 px-8 py-4 rounded-xl font-bold mb-4 shadow-lg">
            START AR
        </button>
        
        <div id="error-log" class="text-red-400 text-xs mt-4 font-mono hidden bg-black p-4 rounded w-full max-w-xs"></div>
    </div>

    <script>
        const button = document.getElementById('ar-button');
        const statusText = document.getElementById('status-text');
        const errorLog = document.getElementById('error-log');

        function logError(msg) {
            errorLog.classList.remove('hidden');
            errorLog.innerHTML += "> " + msg + "<br>";
            console.error(msg);
        }

        async function startAR() {
            if (!('xr' in navigator)) {
                logError("WebXR not found in navigator");
                return;
            }

            try {
                statusText.textContent = "Requesting Session...";
                // We request 'hit-test' which requires the camera feed
                const session = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['hit-test'],
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                });

                statusText.textContent = "Session Started! If screen is black, check Camera Permissions.";
                
                // Initialize Three.js setup
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.xr.enabled = true;
                await renderer.xr.setSession(session);

                // Add a simple light
                const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
                scene.add(light);

                // Add a test cube right in front of the start position
                const cube = new THREE.Mesh(
                    new THREE.BoxGeometry(0.2, 0.2, 0.2),
                    new THREE.MeshPhongMaterial({ color: 0x00ff00 })
                );
                cube.position.set(0, 0, -0.5); // 50cm in front of camera
                scene.add(cube);

                session.addEventListener("end", () => {
                    window.location.reload(); // Reset on exit
                });

                renderer.setAnimationLoop((timestamp, frame) => {
                    renderer.render(scene, camera);
                });

                document.getElementById('overlay').style.display = 'none';

            } catch (e) {
                logError(e.name + ": " + e.message);
                if (e.name === "NotAllowedError") {
                    logError("PERMISSION DENIED: Go to Android Settings and allow Chrome to use Camera.");
                } else if (e.name === "SecurityError") {
                    logError("SECURITY ERROR: WebXR requires HTTPS.");
                }
            }
        }

        button.addEventListener('click', startAR);
    </script>
</body>
</html>
