<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Test</title>
    <!-- Using a slightly older, very stable version -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">

    <!-- This button is standard HTML, it should ALWAYS appear at the top left -->
    <div style="position: fixed; top: 10px; left: 10px; z-index: 9999;">
      <button id="manual-ar-button" style="padding: 20px; background: red; color: white; font-weight: bold; border-radius: 10px;">
        CLICK HERE TO START AR
      </button>
      <p id="status-text" style="background: white; color: black; padding: 5px;">Status: Ready</p>
    </div>

    <a-scene 
      webxr="requiredFeatures: hit-test, local-floor;"
      renderer="alpha: true;">
      
      <!-- The Target Ring -->
      <a-entity id="reticle" ar-hit-test="target: #reticle;">
        <a-ring rotation="-90 0 0" radius-inner="0.05" radius-outer="0.08" color="yellow"></a-ring>
      </a-entity>

      <!-- The Box -->
      <a-box id="box" visible="false" scale="0.2 0.2 0.2" color="blue"></a-box>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const btn = document.getElementById('manual-ar-button');
      const status = document.getElementById('status-text');

      // Force AR Mode when the red button is clicked
      btn.addEventListener('click', function() {
        status.innerText = "Status: Attempting to enter AR...";
        scene.enterVR(); 
      });

      // Check if AR actually started
      scene.addEventListener('enter-vr', function() {
        if (scene.is('ar-mode')) {
          status.innerText = "Status: IN AR MODE - Scan the floor!";
          btn.style.display = 'none'; // Hide button once started
        }
      });

      // Placement logic
      scene.addEventListener('click', function() {
        const reticle = document.getElementById('reticle');
        const box = document.getElementById('box');
        if (reticle.getAttribute('visible')) {
          box.setAttribute('position', reticle.getAttribute('position'));
          box.setAttribute('visible', 'true');
          status.innerText = "Status: Object Placed!";
        }
      });
    </script>
  </body>
</html>
