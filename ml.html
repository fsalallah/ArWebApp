<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Markerless AR - Fixed</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
      #overlay {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 15px;
        border-radius: 10px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: none;
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden;">

    <div id="overlay">
      1. Use a mobile phone (Android/Chrome or iOS/WebXR)<br>
      2. Click "AR" button (bottom right)<br>
      3. Point at floor and tap to place model
    </div>

    <!-- 
      FIX: 'ar-hit-test' is now placed here on the <a-scene> 
      It points to the #reticle as the target to move around.
    -->
    <a-scene 
      webxr="requiredFeatures: hit-test, local-floor;"
      ar-hit-test="target: #reticle; type: footprint;"
      renderer="colorManagement: true; antialias: true; alpha: true;"
      cursor="rayOrigin: mouse"
      raycaster="objects: .raycastable">

      <a-assets>
        <a-asset-item id="campingModel" src="Camping.glb"></a-asset-item>
      </a-assets>

      <!-- Lighting: Increased intensity to prevent "Black Object" -->
      <a-entity light="type: ambient; intensity: 1.5;"></a-entity>
      <a-entity light="type: directional; position: 1 2 1; intensity: 1.2;"></a-entity>

      <!-- The Reticle: Now just a visual container, logic is handled by the scene -->
      <a-entity id="reticle" visible="false">
        <a-ring rotation="-90 0 0" radius-inner="0.08" radius-outer="0.12" color="#00FF00"></a-ring>
      </a-entity>

      <!-- The Model Container -->
      <a-entity id="model-container" visible="false">
        <a-gltf-model 
          src="#campingModel" 
          scale="0.3 0.3 0.3"
          position="0 0 0">
        </a-gltf-model>
      </a-entity>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const reticle = document.getElementById('reticle');
      const modelContainer = document.getElementById('model-container');
      const overlay = document.getElementById('overlay');

      // When the user taps the screen in AR
      scene.addEventListener('click', function () {
        // If the reticle is visible, it means we found a floor
        if (reticle.getAttribute('visible') === true) {
          // Copy position/rotation from reticle to model
          const pos = reticle.getAttribute('position');
          modelContainer.setAttribute('position', pos);
          modelContainer.setAttribute('visible', 'true');
          
          overlay.innerHTML = "Model Placed!";
          setTimeout(() => { overlay.style.display = 'none'; }, 3000);
        }
      });

      scene.addEventListener('enter-vr', () => {
        if (scene.is('ar-mode')) {
          overlay.innerHTML = "Move your phone slowly to find the floor...";
        }
      });
    </script>
  </body>
</html>
